!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},i={typeDecide:function(e,t){return Object.prototype.toString.call(e)==="[object "+t+"]"},serializeObj:function(e){var t="";return Object.keys(e).forEach(function(r){t+=r+"="+e[r]+"&"}),t},stringify:function(t){if(JSON.stringify)return JSON.stringify(t);var r=function(){var e="";return{v:"{"+Object.keys(t).map(function(r){return e="number"==typeof t[r]?"":'"','"'+r+'":'+e+t[r]+e}).join(",")+"}"}}();return"object"===("undefined"==typeof r?"undefined":e(r))?r.v:void 0}},s=function(){function e(r){t(this,e),console.log(r);var n=this;window.onload=function(){n.peep()}}return r(e,[{key:"peep",value:function(){this.config.tryPeep&&(this.config.peepSystem&&this.peepSystem(),this.config.peepJquery&&this.peepJquery(),this.config.peepConsole&&this.peepConsole(),this.config.peepModule&&this.peepModule(),this.config.peepCustom&&this.peepCustom())}},{key:"peepSystem",value:function(){}},{key:"peepJquery",value:function(){}},{key:"peepConsole",value:function(){}},{key:"peepModule",value:function(){}},{key:"peepCustom",value:function(){}}]),e}(),u=function(e){function i(e){t(this,i);var r=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return r.handlers={},r}return n(i,e),r(i,[{key:"on",value:function(e,t){"string"==typeof e&&"function"==typeof t&&(this.handlers[e]="undefined"==typeof this.handlers[e]?[]:this.handlers[e],this.handlers[e].push(t))}},{key:"off",value:function(e){void 0!==this.handlers[e]&&delete this.handlers[e]}},{key:"trigger",value:function(e){return this.handlers[e]instanceof Array&&this.handlers[e].forEach(function(t,r){this.handlers[e][r]()}.bind(this)),void 0!==this.handlers[e]}}]),i}(s),c=function(e){function i(e){t(this,i);var r=o(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));return r.config={mergeReport:!0,delay:1e3,url:"ewewe",except:[/Script error/i],random:1,repeat:5,errorLSSign:"mx-error",maxErrorCookieNo:50,tryPeep:!1,peepSystem:!1,peepJquery:!1,peepConsole:!0},r.config=Object.assign(r.config,e),r}return n(i,e),r(i,[{key:"get",value:function(e){return this.config[e]}},{key:"set",value:function(e,t){this.config[e]=t}}]),i}(u),a=function(e){function s(e){t(this,s);var r=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return r.errorQueue=[],r.repeatList={},r.mergeTimeout=null,r.url=r.config.url,r.srcs=[],["log","debug","info","warn","error"].forEach(function(e,t){var r=this;this[e]=function(n){r.handleMsg(n,e,t)}}.bind(r)),r}return n(s,e),r(s,[{key:"repeat",value:function(e){var t=void 0===e.rowNum||void 0===e.colNum?e.msg:e.msg+e.rowNum+e.colNum;return this.repeatList[t]=void 0===this.repeatList[t]?1:this.repeatList[t]+1,this.repeatList[t]<=this.config.repeat}},{key:"report",value:function(e){var t="",r=this.errorQueue;if(this.config.mergeReport)console.log("合并上报"),t=r.map(function(e){return i.serializeObj(e)}).join("|");else if(console.log("不合并上报"),r.length){var n=r[0];t=i.serializeObj(n)}this.url+="?"+t;var o=new Image;o.onload=function(){r.forEach(function(e){localStorage.setItem("mes",i.stringify(e))}),r=[],e&&e.call(this),this.trigger("afterReport")}.bind(this),o.src=this.url,this.srcs.push(o.src),console.log(this.srcs)}},{key:"send",value:function(e,t){this.trigger("beforeReport"),e?this.mergeTimeout=setTimeout(function(){this.report(t)}.bind(this),this.config.delay):this.report(t)}},{key:"carryError",value:function(e){if(!e)return void console.warn("carryError方法内 error 参数为空");var t=Math.random();return t>=this.config.random?(console.warn("抽样"+t+"|||"+this.config.random),e):(console.warn("不抽样"),void(this.repeat(e)&&this.errorQueue.push(e)))}},{key:"handleMsg",value:function(e,t,r){if(!e)return void console.warn(t+"方法内 msg 参数为空");var n=i.typeDecide(e,"String")?{msg:e}:e;return n.level=r,this.carryError(n),this.send(),n}}]),s}(c),f=function(e){function s(e){t(this,s);var r=o(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return r.rewriteError(),r}return n(s,e),r(s,[{key:"rewriteError",value:function(){var e=this;window.onerror=function(t,r,n,o,s){if(e.trigger("error"))return!1;var u=t;return s.stack&&s&&(u=e.handleErrorStack(s)),i.typeDecide(u,"Event")&&(u+=u.type?"--"+u.type+"--"+(u.target?u.target.tagName+"::"+u.target.src:""):""),e.carryError({msg:u,rolNum:n,colNum:o,targetUrl:r}),e.send(),!0}}},{key:"handleErrorStack",value:function(e){var t=e.stack,r=e.toString();return t.indexOf(r)===-1&&(t+="@",t+=r),t}}]),s}(a);window.Ger=f});
